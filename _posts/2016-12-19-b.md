---
layout: post
title: Thread????
excerpt: "Thread???"
categories: [paragraph]
comments: true
---

---

## thread와 process의 차이점

1. ##### 멀티 프로세스의 문제

두 개의 프로세스는 완전히 독립된 두 개의 프로그램 실행을 위해서 사용되기 때문에 컨텍스트 스위칭(프로세스의 상태 정보를 저장하고 복원하는 일련의 과정)으로 인한 성능 저하가 발생한다.

쓰레드는 하나의 프로그램 내에서 여러개의 실행흐름을 두기 위한 모델이다.

쓰레드는 프로세스처럼 완벽히 독립적인 구조가 아니다. 쓰레드 사이에는 공유하는 요소가 있다.

쓰레드는 공유하는 요소로 인해 컨텍스트 스위칭 하는 과정이 프로세스보다 짧다.

2. ##### __Thread와 Process의 차이점__

프로세스는 완벽히 독립적이기 때문에 메모리 영역(Code, Data, Heap, Stack)을 다른 프로세스와 공유하지 않는다.

쓰레드는 해당 쓰레드를 위한 스택을 생성할 뿐 그 이외의 Code, Data, Heap영역을 공유한다.

- __스택을 독립적으로 할당하는 이유__

스택은 함수 호출 시 전달되는 인자, 되돌아갈 주소값 및 함수 내에서 선언하는 변수 등을 저장하기 위해 사용되는 메모리 공간이다.

따라서 스택 메모리 공간이 독립적이라는 것은 독립적인 함수 호출이 가능하다는 것이고, 이는 독립적인 실행 흐름이 추가되는 것이다.

결과적으로 실행 흐름의 추가를 위한 최소 조건이 독립된 스택을 제공하는 것이다.

- __코드 영역을 공유__

프로세스는 독립적인 구조이기 때문에 다른 프로세스의 Code영역에 있는 함수를 호출할 수 없다.

쓰레드는 Code영역을 공유하기 때문에 두 개 이상의 쓰레드가 자신이 포함된 프로세스의 Code영역에 있는 함수를 호출할 수 있다.

- __데이터 영역과 힙 영역을 공유__

전역 변수와 동적 할당된 메모리 공간을 공유할 수 있고, 이를 통해 쓰레드 간 통신을 할 수 있다.

대신 동시에 메모리에 접근하기 때문에 주의해야 한다.

3. ##### __쓰레드가 프로세스보다 컨텍스트 스위칭이 빠른이유__

쓰레드가 프로세스보다 컨텍스트 스위칭이 빠른 이유는 메모리 영역을 공유하기 때문이다. 실제로 공유되는 데이터가 있고 아닌 데이터가 있다.

- sp(Stack Pointer), fp(Frame Pointer), pc(Program Counter) 레지스터

pc는 실행해야 할 명령어의 위치를 가리키는 레지스터이다.

쓰레드별로 main함수를 독립적으로 가지고 있고, 함수 호출도 독립적으로 진행되기 때문에 쓰레드별로 현재 pc값은 달라야 한다. 따라서 pc는 공유되지 않는다.

쓰레드는 독립적인 스택을 가지기 때문에 스택의 정보를 담고 있는 sp와 fp는 공유되지 않는다.

-  범용적으로 사용가능한 레지스터

시스템을 어떻게 디자인 하느냐에 따라 달라지는 것이기 때문에 일반적으로 공유된다고 할 수 없다.

- 캐시메모리

캐시 메모리는 CPU에서 한번 이상 읽어 들인 메인 메모리의 데이터를 저장하고 있다가 CPU가 다시 그 메모리에 저장된 데이터를 요구할 때 메인 메모리를 통하지 않고 바로 값을 전달하는 용도로 사용된다.

프로세스 사이에서 공유하는 메모리가 하나도 없기 때문에 컨텍스트 스위칭이 발생하면 캐쉬에 있는 모든 데이터를 모두 리셋하고 다시 캐쉬 정보를 불러와야 한다.

쓰레드는 캐쉬 정보를 비울 필요가 없기 때문에 프로세스와 쓰레드의 컨텍스트 스위칭 속도의 차이는 이때 발생한다.

4. ##### __Windows 에서의 프로세스와 쓰레드__

Windows 입장에서 프로세스는 쓰레드를 담는 상자에 지나지 않는다.

또한 Windows에서 프로세스는 상태(Running, Ready, Blocked)을 지니지 않는다. 상태를 지니는 것은 스레드이다.

스케줄러가 실행의 단위로 선택하는 것도 프로세스가 아닌 스레드이다.

프로세스 컨텍스트 스위칭 역시 실제로 오버헤드가 발생하는 부분은 서로 다른 프로세스에 포함된 스레드 간의 컨텍스트 스위칭시 발생한다.

[참고사이트 wiki 스레드?](https://ko.wikipedia.org/wiki/%EC%8A%A4%EB%A0%88%EB%93%9C)
